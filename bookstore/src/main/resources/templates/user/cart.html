<!DOCTYPE html>
<html lang="en" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{user/layoutchung/mainLayout}"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Giỏ hàng</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"
            type="text/javascript"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="/user/css/cart.css">

</head>
<body>
<article layout:fragment="noiDung">
    <div class="wrap cf">
        <div class="heading cf">
            <h1>Giỏ hàng của tôi</h1>
            <a href="/trang-chu" class="continue">Tiếp tục mua </a>
        </div>
        <div class="cart">
            <ul class="cartWrap">
                <li class="items">
                    <input type="checkbox" id="selectAll"> Chọn tất cả
                </li>
                <!-- Lặp qua danh sách sản phẩm từ controller -->
                <li class="items odd" th:each="item : ${danhSachSanPhamTrongGioHang}">
                    <input type="checkbox" class="item-checkbox" name="SachDaChonDeMua" th:value="${item.idGioHangChiTiet}">
                    <div class="infoWrap">
                        <div class="cartSection">
                            <!-- Sử dụng biểu thức Thymeleaf để đổ dữ liệu động -->
                            <img th:src="${item.sach.linkAnh1}" alt="" class="itemImg"/>
                            <p class="itemNumber" th:text="${item.sach.idSach}" name="idSachgh"></p>
                            <h3 th:text="${item.sach.tenSach}"></h3>
                            <form th:action="@{'/gio-hang/cap-nhat-luong-san-pham?idGioHangChiTiet=' + ${item.idGioHangChiTiet}}"
                                  method="post">
                                <p class="qty-control">
                                    <input type="hidden" th:value="${item.sach.idSach}" name="idSachgh" >
                                    <input type="text" class="qty" th:value="${item.soLuong}" name="soLuongSach"
                                           id="soLuongSach"/>
                                </p>
                                <!-- Thêm phần tử cho biểu tượng loading -->
                                <!-- Thêm phần tử cho biểu tượng loading -->

                                <button type="submit" >
                                    <i class="fa-solid fa-rotate-right fa-l" style="color: #f96515;"></i>
                                </button>

                            </form>

                            <div th:each="ctkm : ${item.sach.khuyenMais}">
                                <div th:if="${ctkm.trangThai == 1}">
                                    <div class="pricesale">
                                        <!--                                        <div th:text="${ctkm.soPhanTramGiamGia}"></div>-->
                                        <p th:text="${item.sach.giaBan.subtract(item.sach.giaBan.multiply(new java.math.BigDecimal(ctkm.soPhanTramGiamGia).divide(new java.math.BigDecimal(100))))}"></p>
                                    </div>
                                </div>
                            </div>
                            <p class="price discounted-price" th:text="${item.sach.giaBan}"></p>
                        </div>
                        <div class="cartSection removeWrap">
                            <a th:if="${loggedInUser != null}" th:href="@{'/gio-hang/xoa-san-pham-khoi-gio?idGioHangChiTiet=' + ${item.idGioHangChiTiet} +'&idSachgh='}"
                               class="remove">x</a>
                            <a th:if="${loggedInUser == null}" th:href="@{'/gio-hang/xoa-san-pham-khoi-gio?idSachgh=' + ${item.sach.idSach} + '&idGioHangChiTiet='}"
                               class="remove">x</a>
                        </div>


                    </div>
                </li>
            </ul>
        </div>
        <!-- Thêm nút thanh toán sau phần tổng tiền -->
        <div class="subtotal cf">
            <ul>
                <li class="totalRow">
                    <span class="label">Thành Tiền</span>
                    <!-- Bạn có thể tính tổng giá động trong controller và truyền vào đây -->
                    <span class="value"></span>
                </li>
                <li class="totalRow"><a href="#" class="btn continue">Checkout</a></li>
            </ul>
        </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"></script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
    <script src="/user/js/cart.js"></script>
</article>
</body>
</html>s
